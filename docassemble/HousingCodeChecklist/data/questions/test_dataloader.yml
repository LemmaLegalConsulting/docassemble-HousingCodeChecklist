---
include:
  - docassemble.AssemblyLine:al_package.yml
  - docassemble.SanitaryCode:sanitary_code_template.yml
  - docassemble.RentalRepairLetter:Repair_Letter_Tenant.yml
  - customized_screens.yml 
---
##########################################################
comment: |
  Functionality of this tool:
  
  1. Collect list of conditions, date, time
  
  Output:
  1. Checklist-style document for housing inspector
---
mandatory: True
id: interview order
code: |
  # debug
  introduction
  bad_conditions.gather()
  ending_status

---
metadata:
  title: |-
    MADE Housing conditions app
  authors:
    - Quinten Steenhuis
    - Michael Cronin
    - Joelle Ataya
    - Cherise Barandao
    - Christopher Selak    
    - Michael Carroll
comment: |
  Some of the documents that this interview assembles
  use work done as part of the Assembly Line project.
---
modules:
  - .load_data
  - docassemble.ALToolbox.misc
---
features:
  css:
    - docassemble.ALToolbox:collapse_template.css
---
objects:
  - dataloader: DataLoader.using(filename="housing_code_checklist.xlsx")
  - bad_conditions: DADict.using(object_type=DAObject, complete_attribute='complete', there_are_any=True)
---
objects:
  - bad_conditions[i].details: DADict.using(object_type=DAObject)
---
code: |
  rows = dataloader.get_rows()
---
code: |
  bad_conditions[i].claims
  bad_conditions[i].df
  for condition in bad_conditions[i].claims.true_values():
    bad_conditions[i].details[condition].condition_existed_at_start
  bad_conditions[i].complete = True
---
features:
  question back button: False
---
code: |
  conds = conditions_with_help(dataloader, 'Heat')
---
continue button field: debug
question: |
  
  ${ repr( conds )}
---
id: intro
question: |
  Do you have bad housing conditions? You have options!
subquestion: |
  [FILE mixkit-person-reading-a-book-while-wrapped-in-warm-blankets-with-75-original.png, 100%, Person reading a book while wrapped in a blanket]
  
  A bad housing condition is something in your home that needs to be fixed,
  like a leaky faucet or not having heat in the winter. Some are little and
  some are big. But everyone has a right to a safe home--**without** any
  bad housing conditions.
  
  #### Steps you can take
  
  ${ collapse_template(how_to_defend_eviction_template) }
  ${ collapse_template(how_to_document_template) }
  ${ collapse_template(how_to_notify_landlord_template) }
  ${ collapse_template(get_inspection_template) }
  ${ collapse_template(get_injunction_template) }
  ${ collapse_template(sue_your_landlord_template) }  
buttons:
  - Start tracking problems: track_conditions
    image: clipboard
  - Get help now: get_help
    image: life-ring
  - Explore my rights: rights    
    image: chalkboard-teacher
#video: |
#  [YOUTUBE DCpIr9ldSsw]
field: introduction
---
template: how_to_document_template
subject: |
  Document the problem
content: |
  Keeping good records is important. Before you can get a problem fixed,
  you need to be able to tell your landlord and the court where the problem
  is.
  
  Use the tools that you have to take your records. You can use this website
  to record problems and upload pictures.
  
  You could also:
  
  * Use your phone or a camera to take pictures of the problems.
  * Use a thermometer or a photo of your thermostat and write down the
    time and date of each recording.
  
  The best records come from a housing inspector. See the information below
  about calling an inspector.
---
template: how_to_notify_landlord_template
subject: |
  Notify your landlord
content: |
  Your landlord is only responsible to fix problems that they know about.
  Make sure your landlord knows about problems in your house by telling them,
  even if you think that they should already know.
  
  Use a way to tell your landlord that you can track and prove.
  
  * Write your landlord a text message.
  * Write a letter on paper, and keep a copy for yourself. Make sure the date
    is on the letter.
  * Write an email.
  
  You can use this website to tell your landlord about the problems in your
  home.
---
template: get_inspection_template
subject: |
  Call a housing inspector
content: |
  A housing inspector is someone who works for the city or the housing 
  authority.
  
  If you live in public housing or have a Section 8 voucher, the Housing
  Authority will inspect your home at least once a year. But you can call if 
  you need them to come sooner.
  
  All tenants, including tenants who live in public housing, can call a city
  inspector. The city inspector should come within 1 day to inspect emergency
  problems.
  
  In Boston, Cambridge, Chelsea, and Worcester you can call the Inspectional
  Services Division.
  
  In other cities and towns, call the Board of Health.
  
  Before calling the inspector, use this website to create and print a list of 
  the problems that you have identified. This will help make sure that the
  inspector does not miss any problems.

  [Learn more](https://www.masslegalhelp.org/housing/lt1-chapter-8-getting-inspection).
---
template: get_injunction_template
subject: |
  Get emergency help from a judge
content: |
  You can get emergency help from a judge in two different ways:
  
  1. Ask a judge to enforce an order from a housing inspector.
  1. Get a temporary restraining order.
  
  [Learn more](https://www.masslegalhelp.org/housing/lt1-chapter-8-landlord-refusing-repairs).
---
template: how_to_defend_eviction_template
subject: |
  Stop your eviction
content: |
  Sometimes a landlord will file an eviction case against a tenant if they
  complain about problems in their house.
  
  This is illegal. In Massachusetts, evicting a tenant because they complained
  about bad housing conditions or other housing problems is called
  "retaliation". [Law about retaliation](https://www.masslegalhelp.org/housing/lt1-chapter-12-illegal-eviction).
  
  Even if your landlord is not evicting you **because** you complained about
  problems in your house, the problems may be a defense to your eviction.
  [239 &sect; 
  8A](https://malegislature.gov/Laws/GeneralLaws/PartIII/TitleIII/Chapter239/Section8A) 
  makes bad housing conditions a defense to an eviction if:
  
  1. The eviction is for nonpayment of rent or for no reason.
  1. The problems threaten the health and safety of someone who lives in the
    apartment.
  1. The landlord knew about the problems at a time that the tenant did not
  owe any rent.
  1. The problems were not caused by the tenant.
  1. The problems can be fixed without the tenant moving out permanently.
  
  You can defend against your eviction with MADE, Massachusetts Defense
  Against Eviction.
  
  ${ action_button_html('https://interviews.gbls.org/start/eviction', label='Launch MADE') }
  
---
template: sue_your_landlord_template
subject: |
  Sue your landlord for money
content: |
  You have a right to sue your landlord for money if you have problems in
  your home that your landlord is responsible to fix.
  
  You may be able to sue as part of an existing eviction case. Or you can
  file your own case against your landlord.
  
  It is a good idea to [talk to a lawyer](https://masslrf.org/en/triage/start/housing). You may be able to get a lawyer who will help you for free.
  
  You can sue for:
  
  * Breach of Quiet Enjoyment, which may entitle you to up to 3 months of rent,
    at the market rent for your apartment.
  * Breach of the Warranty of Habitability, which may entitle you to a
    percentage of your rent for every month that the problem existed.
    
  [Learn more about suing your landlord](https://www.masslegalhelp.org/housing/lt1-pullout-13-taking-landlord-to-court).
---  
question: |
  What area do you want to explore?
subquestion: |
  % if len(bad_conditions):
  You have already listed problems in these rooms:
  
  % for button in bad_conditions:
  * [:pencil-alt: ${ button }](${ url_action('bad_conditions["' + button + '"].claims') } )
  % endfor
  % endif
field: bad_conditions.new_item_name
buttons:
  code: |
    [button for button in available_buttons if next(iter(button)) not in bad_conditions ]
---
variable name: available_buttons
data:
  - emergency: Emergency
    image: first-aid
  - Heat: Heating
    image: thermometer-full
  - Bathroom: Bathroom
    image: bath
  - Electricity, Wiring and Gas: Electricity/Gas
    image: plug
  - Garbage: Garbage
    image: trash-alt
  - General Maintenance: General maintenance
    image: tools
  - Structural Maintenance: Structural maintenance    
    image: hard-hat
  - Kitchen: Kitchen
    image: utensils
  - Lead paint: Lead Paint
    image: paint-roller
  - Rodents and insects: Rodents and insects
    image: bug
  - Safety: Safety
    image: door-open
  - Space: Space
    image: house-user
  - Structural Elements: Structural elements
    image: hammer
  - Ventilation and Light: Ventilation and light
    image: sun
  - Water: Water
    image: faucet
question back button: False
---
if: |
  i == 'emergency'
id: Claims
question: |
  Emergency problems
subquestion: |
  What emergency problems have you had?
fields:
  - no label: bad_conditions[i].claims
    datatype: checkboxes
    code: |
      conditions_with_help(dataloader, "24 hours", search_column="Deadline")
    default:
      code: |
        bad_conditions[i].claims.true_values() if defined('bad_conditions[i].claims') else []
---
if:
  i != 'emergency'
id: Non-emergency claims
question: |
  Problems with ${ i }
fields:
  - no label: bad_conditions[i].claims
    datatype: checkboxes
    code: |
      conditions_with_help(dataloader, i)
    default:
      code: |
        bad_conditions[i].claims.true_values() if defined('bad_conditions[i].claims') else []
---
id: there is another condition
question: |
  Do you want to list problems in another room?
subquestion: |
  So far you have told us about problems in ${ comma_and_list(bad_conditions.keys()) }
yesno: bad_conditions.there_is_another
---
depends on:
  - bad_conditions[i].claims
code: |
  bad_conditions[i].df = dataloader.load_rows(bad_conditions[i].claims.true_values())
---
event: ending_status
id: abc
question: |
  Here is what you told us so far
subquestion: |
  % for category in bad_conditions:
  #### [${ category }](${ url_action('bad_conditions["' + category + '"].claims') } )
  
  % for index, row in bad_conditions[category].df.iterrows():
  * ${ row['Description'] }
  % endfor
  % endfor
  
  ${ bad_conditions.add_action() }

  ${ action_button_html(url_action('download_checklist'), label='Download the checklist', icon='download') }
  
  ${ action_button_html(url_ask(['sanitary_code_template', 'download_petition_to_enforce_sanitary_code']), label="Download a petition to enforce the sanitary code", icon="download") }
  
  ${ action_button_html(url_ask(['interview_order_tenant_repair_request', 'download_tenant_repair_letter']), label="Download a letter to your landlord", icon="download") }
---
event: download_checklist
id: download checklist
question: |
  Housing Code Checklist
subquestion: |
  ${ checklist_attachment }
---
code: |
  # TODO: we may not want this always enabled if the bundles change
  sanitary_code_instructions_attachment.enabled = False
  sanitary_code_template_attachment.enabled = True
---
event: download_petition_to_enforce_sanitary_code
id: download sanitary code
question: |
  Your file is ready to download
subquestion: |
  ${ sanitary_code_bundle.download_list_html() }
  
  ${ sanitary_code_bundle.send_button_html() }

---
objects:
  - sanitary_code_bundle: ALDocumentBundle.using(elements=[sanitary_code_instructions_attachment, sanitary_code_template_attachment], filename="petition_to_enforce_sanitary_code")
---
attachment:
  variable name: checklist_attachment
  docx template file: Housing_Code_Checklist.docx
---
id: details for this claim
question: |
  Details about the problem with "${ bad_conditions[i].df.loc[int(j)]['Description'].lower().lstrip() }"
fields:
  - This condition started when I first moved in: bad_conditions[i].details[j].condition_existed_at_start
    datatype: yesno
  - Date condition started: bad_conditions[i].details[j].start_date
    datatype: date
    help: |
      Use the month and year if that is the best that you know.
    hide if: bad_conditions[i].details[j].condition_existed_at_start    
  - The problem with "${ bad_conditions[i].df.loc[int(j)]['Description'].lower().lstrip() }" is fixed: bad_conditions[i].details[j].condition_ended
    datatype: yesno
  - Date condition ended: bad_conditions[i].details[j].end_date
    datatype: date
    show if: bad_conditions[i].details[j].condition_ended
  - Describe the problem using your own words: bad_conditions[i].details[j].description
    datatype: area
    required: False
  - Upload any documents that you have that show the problem: bad_conditions[i].details[j].files
    datatype: files
    required: False